{
    "sourceFile": "front/js/product.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1678460180178,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1678460180178,
            "name": "Commit-0",
            "content": "const queryString = window.location.search\nconst urlParams = new URLSearchParams(queryString)\nconst id = urlParams.get(\"id\")\nif (id != null){\n    let itemPrice = 0\n    let imgUrl, altText\n    let productName\n}\n\nfetch(`http://localhost:3000/api/products/${id}`)\n   .then((reponse) => reponse.json())\n   .then((res) => getDataKanap(res)) \n\nfunction getDataKanap(product) {\n    //récupération de toutes les données dans l'objet kanap\n    const {altTxt, colors, description, imageUrl, name, price, id}  = product\n    //les données sont passées dans des fonctions qui vont les afficher\n    itemPrice = price\n    imgUrl = imageUrl\n    altText = altTxt\n    productName = name \n    makeImage(imageUrl, altTxt)\n    makeTitle(name)\n    makePrice(price)\n    makeDescription(description)\n    makeColors(colors)\n}\nfunction makeImage(imageUrl, altTxt){\n    const image = document.createElement(\"img\")\n    image.src = imageUrl\n    image.alt = altTxt\n    const parent = document.querySelector(\".item__img\")\n    if(parent != null)parent.appendChild(image)\n    return image\n} \nfunction makeTitle(name) {\n    const h1 = document.querySelector(\"#title\")\n    if(h1 != null)h1.textContent = name\n    return name\n}\nfunction makePrice(price) {\n    const quantity = Number.parseInt(document.querySelector(\"#quantity\").value)\n\n    const span = document.querySelector(\"#price\")\n   if (span !=null)span.textContent = price \n}\nfunction makeDescription(description) {\n    const p = document.querySelector(\"#description\")\n    if (p != null)p.textContent = description\n}\nfunction makeColors(colors) {\n    const select = document.querySelector(\"#colors\")\n    colors.forEach((color) => {\n        const option = document.createElement(\"option\")\n        option.value = color\n        option.textContent = color\n        select.appendChild(option)\n    })\n}\n    const buttonToCart = document.querySelector(\"#addToCart\")\n    buttonToCart.addEventListener(\"click\", buttonEvent)\nfunction buttonEvent(){\n    const color = document.querySelector(\"#colors\").value\n    const quantity = Number.parseInt(document.querySelector(\"#quantity\").value)\n    if (invalidCommand(color, quantity)) return\n    saveCommand(color,quantity)\n    redirectToCart()\n}\nfunction invalidCommand(color, quantity){\n    if (color == null || color === \"\" ) {\n        alert(\"Vous devez sélectionner une couleur. Merci\")\n        return true\n        }\n  if (quantity == null || quantity <= 0 || quantity > 100 ||!Number.isInteger(quantity)) {\n      alert(\"Vous devez sélectionner une quantité de 1 à 100. Merci\")\n    return true\n    }\n} \n\n//Sauvegarde dans localStorage if commande valide\nfunction saveCommand(color, quantity){\n    let isFound = false;\n    let panier = localStorage.getItem(\"panier\") \n    if(!panier){  // soit le panier est vide\n        let data = [{\n            id : id,\n            color : color,\n            quantity: Number(quantity),\n        }];\n        localStorage.setItem(\"panier\", JSON.stringify(data))\n    }else{ // soit le panier n'est pas vide\n        panier = JSON.parse(panier);\n\n        panier.forEach(item =>{\n            if(isFound) return;\n            if(id === item.id && color === item.color){\n                item.quantity = Number(item.quantity) + Number(quantity);\n                isFound = true\n            }\n        })\n\n        if(!isFound){\n            panier.push( {\n                id : id,\n                color: color,\n                quantity: Number(quantity),\n            })\n        }\n\n        localStorage.setItem(\"panier\",JSON.stringify(panier))\n    }\n}\nfunction redirectToCart(){\n    window.location.href = \"cart.html\"\n}"
        }
    ]
}